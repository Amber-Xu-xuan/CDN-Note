- 最佳路由
- 响应时间
- 可用性
- 服务质量

CDN提供的一种机制，当用户请求内容，可以以最快速度交付的Cache来用户提供

### 主要功能
负责随所有发起服务请求的用户进行访问调度，确定给用户的最终实际访问地址

**全局负载均衡（GSLB Global Server Load Balance）**：就近原则，确定向用户提供服务的cache物理地址
**本地负载均衡（SLB）**：节点内部的设备负载均衡

#### 全局负载均衡（GSLB）
基于DNS解析、HTTP重定向、IP路由
DNS就是IP地址和网址互换
本地DNS服务器缓存地址、域名解析最终结果

Internet类资源记录分为

- A记录（address）：域名->多个IP的映射。对同一个域名，可以有多条A记录

- NS记录（name server）：指定由哪台DNS服务器来解析

- SOA记录（start of authority）：指定该区域的权威域名服务器

- CNAME记录（canonical name）：多个域名->服务器的映射

- PTR记录（pointer record）：IP->域名的映射

##### 方法
域名服务器获得CNAME记录，用记录中别名替换查找的域名或主机名，查询这个别名的A记录获取IP地址
具体：1.将GSLB的主机名定义成所查询域名的权威DNS服务器的别名
2.GSLB主机名添加多条A记录，分别对应多个服务器的IP地址
3.本地DNS服务器会向客户端返回多个IP地址作为域名的查询结果，这些IP地址的排列顺序是轮换

**负载均衡器**（代理DNS服务器）->权威DNS服务器（修改权威DNS服务器返回的响应信息）
负载均衡器会根据自己的策略选择一个性能最好的服务器IP并修改需要实现**GSLB的域名的DNS查询响应**，对其他请求透明转发，这样就不会影响整个域名空间的解析性能。
域名解析列表
- Cache更新时间越短，用户请求达到GSLB的几率越大
域名服务器和DNS服务器的区别？？？

## 基本概念
### 集群
由多个同时运行同一个web应用的服务器组成
一组相互独立的服务器在网络中表现为单一的系统，并以单一系统的模式加以管理，此单一系统为客户工作站提供高可靠性的服务。
#### 集群分类
- 高性能集群（HPC Cluster）：提高科学计算能力
- 高可用性集群（HA Cluster）：指为了使群集的整体服务尽可能可用，减少服务宕机时间为目的的集群技术
    - 主-主工作方式（Active-Active）：在只有一个节点时也能提供可以接受的性能
> 目前运用最为广泛的双节点双应用的Active/Active模式
    - 主-从工作方式（Active-Standb）：需要一个在正常工作时处于备用状态的节点，主节点处理客户机的请求，而备用节点处于空闲状态，当主节点出现故障时，备用节点会接管主节点的工作，继续为客户机提供服务，并且不会有任何性能上影响。
> 应用连接各系统组件：外置共享的磁盘阵列、文件系统和浮动IP地址等组成业务运行环境。
- 高可扩展性集群：有负载均衡策略（算法）的服务器群集技术，该方案非常适合于运行同一组应用程序的节点
- 

### 负载均衡
负责多个服务器之间（集群内）实现合理的任务分配
定义：多个节点之间按一定的策略（算法）分发网络或计算处理负载
1.分析数据包
2.分配请求

可设置专门的网关
负载均衡器

1.物理
2.数据链路层：实现负载均衡的原理是根据数据包的目的MAC地址选择不同的路径
3.网络：基于IP地址的分配方式将数据流疏通到多个节点
4.传输：交换（Switch）
5.会话
6.表示层
7.应用：交换（Switch）

### 基于负载均衡的算法
- 轮询（Round-Robin）：将请求依次分配给集群中的节点进行处理
- 最小连接数（Least Connection First）：为集群中的每台服务器设置一个记数器，记录每个服务器当前的连接数，负载均衡系统总是选择当前连接数最少的服务器分配任务
- 快速响应优先（Faster Response Precedence）：根据集群的节点状态（CPU、内存等主要处理部分）分配任务。很少采用这个，是未来发展方向。深入服务器处理系统进行检测

#### DNS轮询
在DNS中为多个地址配置同一个名字，查询这个名字的客户机将得到其中一个地址从而使得不同的客户访问不同的服务器，达到负载均衡的目的。

- 缺点：
    1. 不能区分服务器的差异
    2. 不能反映服务器的运行状态
    3. 需保证不同客户计算机均匀获得不同地址
    4. DNS数据具备刷新时间标志一旦超过这个时间限制，其他DNS服务器就需要和这个服务器交互，以重新获得地址数据，就有可能获得不同IP地址。时间过短，DNS流程大增造成额外的网络问题。
    5. 服务器故障后续修改DNS设置要等一定时间，客户才能正常访问

#### 反向代理服务器
代理多个客户访问内部服务器
负载均衡+代理服务器的高速缓存技术，必须为每个服务开个反向代理服务器
- 代理服务器：请求转发给内部的服务器
- 标准代理方式：客户使用代理访问多台外部服务器


#### 地址转换网关
将一个外部IP地址映射为多个内部IP地址
对每次TCP连接请求动态使用其中一个内部地址
根据服务器的连接数或响应时间进行负载均衡

OCS（内容中心）
GRM（全局资源管理设备）
- 隐藏节点：部署一台备份的GSLB设备，对外隐藏不公布
- HTTP重定向：301永久性转移（permanently moved）、302暂时转移（temporarily moved）、meta fresh在特定时间后重定向到新页面。不适合其他应用。比如MMS协议，RTSP协议
- HTTP重定向必须解析域名URL，建立TCP连接并发送请求。
- 所有请求是必须进入GSLB系统，成为性能和可靠性的瓶颈（流媒体）


基于DNS解析方式 | 基于HTTP重定向| 基于IP路由方式
---|:--:|---:
||||

##### 基于IP路由的GSLB
- 路由协议算法